research:
  description: |
    The user submitted the following request:

    ---
    {user_input}
    ---

    Your job is to research relevant facts, insights and data — using internal documents and web search. Organize your findings clearly. Use bullet points grouped by topic, theme, or aspect. For every finding that comes from the internal documents, you must always cite the filename as the source (the filename is always available in the metadata). If a finding comes from the web, cite the full URL. Do not write full answers or explanations — just provide factual, structured findings.

    Every source starting with "http://"" or "https://" should be read with the web_scrape tool.

  expected_output: |
    You will write clean and structured notes. Use bullet points, grouped by topic. Every bullet point must include a source: the filename (for internal knowledge) or the URL/site (for web search). Do not write conclusions or answers. Use markdown without "```" and write the result to `research.md`. If you are done, say "Research complete"

  agent: researcher

write_report:
  description: |
    Based on the research below, write a full, user-friendly response to the original request.

    ---
    {user_input}
    ---

    Use the provided research from `research.md` to create a clean, well-written and logically structured answer or report. Be clear, concise and professional. If structure is implied, follow it. Every statement or claim must be clearly sourced: use the filename for internal documents, and the full URL for web findings. If a statement is not sourced, it must not appear in the report.

  expected_output: |
    A polished, complete written report that addresses the user's request. Every statement must include a source (filename or URL). Use markdown without "```" and write the result to `report.md`. Do not use horizontal lines (---) anywhere in the report. If you are done, say "Report complete".

  agent: writer

  context:
    - research

review_report:
  description: |
    A report has been written in response to the following user request:

    ---
    {user_input}
    ---

    Review the report (`report.md`) for structure, clarity, factual completeness, writing quality, and especially for correct and complete source citations. Every statement must have a source (filename for internal knowledge, URL/site for web). If improvements are needed, point them out specifically. If the text is solid, approve it confidently.

  expected_output: >
    Either "approved" or "changes_requested" with a list of specific points to fix.

  agent: critic

  context:
    - write_report

improve_report:
  description: |
    The report (`report.md`) has been reviewed and needs improvements. Improve the report according to the reviewer's feedback. Address every point raised, especially regarding structure, clarity, completeness, writing quality, and source citations. Ensure every statement has a correct source (filename for internal knowledge, URL/site for web). If the report is now solid, say "Report complete".

  expected_output: >
    An improved version of the report that addresses all reviewer feedback. Use markdown without "```" and write the result to `report.md`. If you are done, say "Report complete".

  agent: writer
  context:
    - write_report
    - review_report
