document_research:
  description: |
    Document Research:

    1. Read the file `request.md` to understand the user's request by using the workspace_file_read tool.
    2. Think about relevant research questions (and variations) you will answer with the documents. 
    3. Find and extract relevant facts, insights and data from internal documents by using the document_search tool.  
        Organize your findings clearly. Use bullet points grouped by topic, theme, or aspect.  
        For every finding, cite the filename and page as the source.

    Important rules:
      - Context should only be used for research and will be left out of the final report.
      - Create your own research findings structure (request structure will be considered separately later)
      - sources must be full filenames of documents with page numbers included
      - findings should only include content from internal documents, not from Jira or Confluence
      - Avoid irrelevant information at all costs
      - If you dont know something or research had no results, just tell it straight
      - Use only the document_search tool to find relevant document chunks (workspace_file_read is for reading `request.md`).
      - Do not use horizontal lines (---)
      - Use markdown without "```"

    Sometimes the user references information from another system explicitly. Do not create research subtasks for those topics. For example:
      "Find out what the title of the issue CXAP4-12 is in Jira" (you know that you don't need to research internal documents for that).

  expected_output: |
    A detailed, well-structured research report in Markdown.

  async_execution: false
  agent: document_knowledge_manager

  tools:
    - document_search
    - document_chunk_context
    - workspace_file_read

confluence_research:
  description: |
    Confluence Research:

    1. Read the file `request.md` to understand the user's request by using the workspace_file_read tool.
    2. Think about relevant research questions (and variations) you will answer with the Confluence Wiki. 
    3. Extract relevant facts, insights and data. Organize your findings clearly.  
      Use bullet points grouped by topic, theme, or aspect.  
      For every finding, cite the URL as the source.

    Important rules:
      - get the full page with confluence_get_page after identifying relevant pages
      - findings should only include content from Confluence, not from Jira
      - Create your own research findings structure (request structure will be considered separately later)
      - sources must be full URLs to the Confluence pages
      - Avoid irrelevant information at all costs
      - If you dont know something or research had no results, just tell it straight
      - Do not use horizontal lines (---)
      - Use markdown without "```"

    Sometimes the user references information from another system explicitly. Avoid researching those topics. For example:
      "Find out what the title of the issue CXAP4-33 is in Jira" (you know that you don't need to research Confluence for that).

    ---
    confluence_available: {confluence_available}

  expected_output: |
    A detailed, well-structured research report in Markdown or "Confluence not available".

  async_execution: false
  agent: atlassian_knowledge_manager

  context:
    - document_research

  tools:
    - workspace_file_read

  mcp_tools:
    - confluence_search
    - confluence_search_user
    - confluence_get_page
    - confluence_get_page_children
    - confluence_get_comments
    - confluence_get_labels

jira_research:
  description: |
    Jira Research:

    1. Read the file `request.md` to understand the user's request by using the workspace_file_read tool.
    2. Think about relevant research questions (and variations) you will answer with the Jira System. 
    3. Extract relevant resources and organize your findings clearly.  
      Use bullet points grouped by topic, theme, or aspect.  
      For every finding, cite the URL as the source.


    Important rules:
      - findings should only include content from Jira, not from Confluence
      - Create your own research findings structure (request structure will be considered separately later)
      - sources must be full URLs to the Jira issues or resources
      - Avoid irrelevant information at all costs
      - If you dont know something or research had no results, just tell it straight
      - Always use jira_base_url for source links.
      - Do not use horizontal lines (---)
      - Use markdown without "```"

    Sometimes the user references information from another system explicitly. Avoid researching those topics. For example:
      "Get the headline of Confluence page 46596097" (you know that you don't need to research Jira for that).

    ---
    jira_available: {jira_available}
    jira_base_url: {jira_url}

  expected_output: |
    A detailed, well-structured research result (as Markdown) or "Jira not available".

  async_execution: false
  agent: atlassian_knowledge_manager

  context:
    - document_research

  tools:
    - workspace_file_read

  mcp_tools:
    - jira_search
    - jira_search_fields
    - jira_get_user_profile
    - jira_get_issue
    - jira_get_project_issues
    - jira_get_transitions
    - jira_get_worklog
    - jira_get_agile_boards
    - jira_get_board_issues
    - jira_get_sprints_from_board
    - jira_get_sprint_issues
    - jira_get_link_types
    - jira_get_project_versions
    - jira_get_all_projects
    - jira_batch_get_changelogs
    # - jira_download_attachments

write_report:
  description: |
    1. Read the file `request.md` to understand the user's request.
    2. Study all the research results available.
    3. Create a clean, well-written and logically structured answer or report based on the research results.  
      Be clear, concise and professional. If structure from the users request is implied, follow it. Every statement or claim must be clearly sourced:

      - Documents: A Markdown link directly after the content, always with the folder `../knowledge/`, e.g. [Source Document.pdf Page 9](../knowledge/Source%20Document.pdf)
      - Web links: A Markdown link directly after the content, e.g. [PageName](https://...)

    Important:
      - If a statement does not have a source, it must not appear
      - Do not use horizontal lines (---)
      - Use markdown without "```"

  expected_output: |
    A well-written, structured report in Markdown.

  agent: corporate_communications_specialist

  context:
    - document_research
    - confluence_research
    - jira_research

review_report:
  description: |
    Review the report for structure, clarity, factual completeness, writing quality, and especially for correct and complete citations.  
    Every statement must have a source. Use the following citation format:

      - Documents: A Markdown link directly after the content, always with the folder `../knowledge/`, e.g. [Source Document.pdf Page 3](../knowledge/Source%20Document.pdf)
      - Web links: A Markdown link directly after the content, e.g. [PageName](https://...)

    If improvements are needed, list them specifically. If the text is solid, give a clear approval.

  expected_output: >
    Either "approved" or "changes_requested" with a list of specific points to fix.

    Approval Example:

    {
      "result": "approved",
      "requested_changes": []
    }

    Change Request Example:

    {
      "result": "changes_requested",
      "requested_changes": [
        "Citation `[Doc.pdf Page 2](Doc.pdf)` must be relative to the '../knowledge/' directory.",
        "Citation `[Stuff XY.pdf](../knowledge/Stuff%20XY.pdf)` must have a page number.",
        "Link [https://api.example.com/data] must be a user-facing link.",
        "Several statements in the 'Recommendations' section lack sources and must be supported by evidence from the research."
      ]
    }

  agent: critical_reviewer

  context:
    - write_report

improve_report:
  description: |
    The report has been reviewed and needs improvements. 

    1. Improve the report according to the reviewer's feedback. 
       Address every point raised, especially regarding structure, clarity, completeness, writing quality, and source citations. 
    2. Write the polished, final version that meets all criteria to `report.md`.

    Important:
      - always write the file and never return the report directly
      - If a statement does not have a source, it must not appear
      - Do not use horizontal lines (---)
      - Use markdown without "```"

  expected_output: >
    If you are done, say "Report Done".

  agent: corporate_communications_specialist

  context:
    - write_report
    - review_report

  tools:
    - workspace_file_write
